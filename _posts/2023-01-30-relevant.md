---
layout: post
title: Relevant
date: 2023-01-30 11:00 +0700
categories: [THM, medium]
---

### Introduction

[Relevant] is a medium CTF on TryHackMe. You have been assigned to a client that wants a penetration test conducted on an environment due to be released to production in seven days.

I did the machine without the use of metasploit but you can use It as to complete it too.


![relevant](https://tryhackme-images.s3.amazonaws.com/room-icons/10524728b2b462e8d164efe4e67ed087.jpeg)


---

Let's start scaning the machine with nmap.

We can see some ports open.

![scan](/images/THM/relevant/Captura.PNG)

We will start looking through smb.

{ *I used "gest" like username but my intention was to use "guest" xD.* }

![smbmap dirs](/images/THM/relevant/Captura1.PNG)

We can see there are 4 Folders but we only have access to two of them.

If we look the content of the folder **nt4wrksv**, we can see there is a file called **passwords.txt**

![smbmap dir nt4](/images/THM/relevant/Captura2.PNG)

Let's download It.

![smbmap down file](/images/THM/relevant/Captura3.PNG)

If we see the content we can see is encoded in base64.

![cat file](/images/THM/relevant/Captura4.PNG)

Time to desencode It.

![base64 bob](/images/THM/relevant/Captura5.PNG)

![base64 bill](/images/THM/relevant/Captura6.PNG)

Let's try to use psexec with both users and try if we could get a shell.

![psexec bob](/images/THM/relevant/Captura8.PNG)

![psexec bill](/images/THM/relevant/Captura9.PNG)

Both trys didn't work so, It's time to look more the 2 Webs.

Web in 80 and 49663 have the same default.

![IIS web](/images/THM/relevant/Captura10.PNG)

This time I will use dirbuster to change a little the enumeration tool.

![dirbuster](/images/THM/relevant/Captura11.PNG)

The scan don't return nothing in both webs, but if we investigate a little, we can see that the smb folder is accessible via the web.

![Web dir](/images/THM/relevant/Captura12.PNG)

We're going to take advantage from our permissions, because we can write so, I uploaded a webshell.

![WebShell upload](/images/THM/relevant/Captura13.PNG)

We can see It uploaded fine and we can write commands on It.

![WebShell](/images/THM/relevant/Captura14.PNG)

If we search a little we can find the user flag in the **Bob Desktop**.

![user flag](/images/THM/relevant/Captura15.PNG)

- User.txt
>Answer: THM{fdk4ka34vk346ksxfr21tg789ktf45}

It's time to elevate our privileges.

![whoami](/images/THM/relevant/Captura17.PNG)

So we look what privileges We've with our user

We can see our user have the **SeImpersonatePrivilege** which we can abuse this privilege to elevate our privileges.

If you want to know more you can search about **RootenPotato**.

![whoami privi](/images/THM/relevant/Captura16.PNG)

In this case we are going to use [PrintSpoofer] that is a new tool more new and work better in windows 10 and Server 2016/2019.

![printspoofer github](/images/THM/relevant/Captura18.PNG)

We will upload the **PrintSpoofer** to the server.

![PrintSpoofer upload](/images/THM/relevant/Captura19.PNG)

And **ncat** too, to get a rever shell with the SYSTEM privileges.

![ncat upload](/images/THM/relevant/Captura20.PNG)

Now we execute the command.

![Execution](/images/THM/relevant/Captura21.PNG)

And if all is okay we can see we got a shell with the SYSTEM perms.

![nc listener](/images/THM/relevant/Captura22.PNG)

Now we can check the root flag and we've complete this machine.

![root flag](/images/THM/relevant/Captura23.PNG)

- Root.txt
>Answer: THM{1fk5kf469devly1gl320zafgl345pv}

[relevant]:https://tryhackme.com/room/relevant
[printspoofer]:https://github.com/itm4n/PrintSpoofer
